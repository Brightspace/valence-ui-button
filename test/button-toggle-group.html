<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>d2l-button basic tests</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
		<script src="../../@webcomponents/webcomponentsjs/webcomponents-bundle.js"></script>
		<script src="../../wct-browser-legacy/browser.js"></script>
		<script src="../../@polymer/iron-test-helpers/mock-interactions.js" type="module"></script>
		<script type="module" src="../d2l-button-toggle.js"></script>
		<script type="module" src="../d2l-button-toggle-group.js"></script>
	</head>
	<body>
		<test-fixture id="basic">
			<template>
				<d2l-button-toggle-group label="the label">
					<d2l-button-toggle>First</d2l-button-toggle>
					<d2l-button-toggle>Second</d2l-button-toggle>
				</d2l-button-toggle-group>
			</template>
		</test-fixture>
		<script type="module">
import '../d2l-button-toggle.js';
describe('<d2l-button-toggle>', function() {
	let toggleGroup;

	function _expectTabindex(index) {
		for (let i = 0; i < toggleGroup._buttons.length; i++) {
			expect(toggleGroup._buttons[i].tabindex).to.equal(i === index ? 0 : -1);
		}
	}
	describe('basic', function() {

		beforeEach(function() {
			toggleGroup = fixture('basic');
		});

		it ('should reflect disabled attribute to property', function() {
			expect(toggleGroup.disabled).to.be.false;
			toggleGroup._buttons.forEach(b => { expect(b.disabled).to.be.false; });
			toggleGroup.setAttribute('disabled', true);
			expect(toggleGroup.disabled).to.be.true;
			toggleGroup._buttons.forEach(b => { expect(b.disabled).to.be.true; });
		});

		it ('should reflect label attribute to property', function() {
			expect(toggleGroup.label).to.equal('the label');
			toggleGroup.setAttribute('label', 'new label');
			expect(toggleGroup.label).to.equal('new label');
		});

		it ('should reflect orientation attribute to property', function() {
			expect(toggleGroup.orientation).to.equal('horizontal');
			toggleGroup.setAttribute('orientation', 'vertical');
			expect(toggleGroup.orientation).to.equal('vertical');
		});

		it ('should have a default _lastFocused of the first button', function() {
			expect(toggleGroup._lastFocused).to.equal(toggleGroup._buttons[0]);
		});

		it ('should set the default tab indices correctly', function() {
			expect(toggleGroup._buttons[0].tabindex).to.equal(0);
			for (let i = 1; i < toggleGroup._buttons.length; i++) {
				expect(toggleGroup._buttons[i].tabindex).to.equal(-1);
			}
		});

		it ('should update the tab indices and _lastFocused when a button is clicked', function() {
			const newClick = 1;
			const clickedButton = toggleGroup._buttons[newClick];
			MockInteractions.tap(clickedButton);
			expect(toggleGroup._lastFocused).to.equal(clickedButton);
			_expectTabindex(newClick);
		});

		describe('keyboard navigation', function() {
			it ('should update the tab indices and _lastFocused when the left and right arrow keys are pressed and orientation is horizontal', function() {
				toggleGroup._buttons[0].focus();
				MockInteractions.keyDownOn(toggleGroup._buttons[0], 39);
				expect(toggleGroup._lastFocused).to.equal(toggleGroup._buttons[1]);
				_expectTabindex(1);
				MockInteractions.keyDownOn(toggleGroup._buttons[1], 37);
				expect(toggleGroup._lastFocused).to.equal(toggleGroup._buttons[0]);
				_expectTabindex(0);
			});
			it ('should not update the tab indices and _lastFocused when the up and down arrow keys are pressed and orientation is horizontal', function() {
				toggleGroup._buttons[0].focus();
				MockInteractions.keyDownOn(toggleGroup._buttons[0], 38);
				expect(toggleGroup._lastFocused).to.equal(toggleGroup._buttons[0]);
				_expectTabindex(0);
				MockInteractions.keyDownOn(toggleGroup._buttons[0], 39);
				MockInteractions.keyDownOn(toggleGroup._buttons[1], 40);
				expect(toggleGroup._lastFocused).to.equal(toggleGroup._buttons[1]);
				_expectTabindex(1);
			});
			it ('should update the tab indices and _lastFocused when the up and down arrow keys are pressed and orientation is vertical', function() {
				toggleGroup.orientation = 'vertical';
				toggleGroup._buttons[0].focus();
				MockInteractions.keyDownOn(toggleGroup._buttons[0], 40);
				expect(toggleGroup._lastFocused).to.equal(toggleGroup._buttons[1]);
				_expectTabindex(1);
				MockInteractions.keyDownOn(toggleGroup._buttons[1], 38);
				expect(toggleGroup._lastFocused).to.equal(toggleGroup._buttons[0]);
				_expectTabindex(0);
			});
			it ('should not update the tab indices and _lastFocused when the left and right arrow keys are pressed and orientation is vertical', function() {
				toggleGroup.orientation = 'vertical';
				toggleGroup._buttons[0].focus();
				MockInteractions.keyDownOn(toggleGroup._buttons[0], 39);
				expect(toggleGroup._lastFocused).to.equal(toggleGroup._buttons[0]);
				_expectTabindex(0);
				MockInteractions.keyDownOn(toggleGroup._buttons[0], 40);
				MockInteractions.keyDownOn(toggleGroup._buttons[1], 37);
				expect(toggleGroup._lastFocused).to.equal(toggleGroup._buttons[1]);
				_expectTabindex(1);
			});
		});
	});
});
